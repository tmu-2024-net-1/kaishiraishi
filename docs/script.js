var x = 0;
var y = 0;
var stepSize = 5.0;

var font = 'Zen Old Mincho';

var letters1 = "小説と云うものは、本来、女子供の読むもので、いわゆる利口な大人が目の色を変えて読み、しかもその読後感を卓を叩いて論じ合うと云うような性質のものではないのであります。小説を読んで、襟えりを正しただの、頭を下げただのと云っている人は、それが冗談ならばまた面白い話柄でもありましょうが、事実そのような振舞いを致したならば、それは狂人の仕草と申さなければなりますまい。たとえば家庭に於いても女房が小説を読み、亭主が仕事に出掛ける前に鏡に向ってネクタイを結びながら、この頃どんな小説が面白いんだいと聞き、女房答えて、ヘミングウェイの「誰がために鐘は鳴る」が面白かったわ。亭主、チョッキのボタンをはめながら、どんな筋だいと、馬鹿にしきったような口調で訊たずねる。女房、俄にわかに上気し、その筋書を縷々るると述べ、自らの説明に感激しむせび泣く。亭主、上衣を着て、ふむ、それは面白そうだ。そうして、その働きのある亭主は仕事に出掛け、夜は或るサロンに出席し、曰いわく、この頃の小説ではやはり、ヘミングウェイの「誰がために鐘は鳴る」に限るようですな。小説と云うものは、そのように情無いもので、実は、婦女子をだませばそれで大成功。その婦女子をだます手も、色々ありまして、或あるいは謹厳を装い、或いは美貌をほのめかし、あるいは名門の出だと偽り、或いはろくでもない学識を総ざらいにひけらかし、或いは我が家の不幸を恥も外聞も無く発表し、以て婦人のシンパシーを買わんとする意図明々白々なるにかかわらず、評論家と云う馬鹿者がありまして、それを捧げ奉り、また自分の飯の種にしているようですから、呆れるじゃありませんか。最後に云って置きますが、むかし、滝沢馬琴と云う人がありまして、この人の書いたものは余り面白く無かったけれど、でも、その人のライフ・ワークらしい里見八犬伝の序文に、婦女子のねむけ醒ざましともなれば幸なりと書いてありました。そうして、その婦女子のねむけ醒しのために、あの人は目を潰つぶしてしまいまして、それでも、口述筆記で続けたってんですから、馬鹿なもんじゃありませんか。余談のようになりますが、私はいつだか藤村と云う人の夜明け前と云う作品を、眠られない夜に朝までかかって全部読み尽し、そうしたら眠くなってきましたので、その部厚の本を枕元に投げ出し、うとうと眠りましたら、夢を見ました。それが、ちっとも、何にも、ぜんぜん、その作品と関係の無い夢でした。あとで聞いたら、その人が、その作品の完成のために十年間かかったと云うことでした。　　　　　　　　";
var letters3 = "あわびの水貝は、あわびを切っただけでよいようなものであるが、これは元来、江戸前の料理だ。それと言うのも、関西にあわびがないからだ。あわびにかぎらず、貝というものは、東京を本場としなければならない。東京のほうは品物も豊富なので、料理法も心得ている。私どもも、そのコツは江戸前の料理から覚えたのだが、あわびの水貝料理は、あわびを固くすることが秘訣だ。まず生きのいい雄貝を塩をたくさん使って揉む。そうすると、塩のために、石突きが石のように固くなる。塩をたくさん用いれば用いるほど固くなる。塩が少ないと中の方までは固くならない。上皮だけが固くても、中の方がグニャグニャしていては余り美味いものはつくれない。中まで固い方がよいのだが、それは生きのよいものに塩を多く用いることで、これが水貝のコツである。肉面に苔のついたような青いのが雄で、必ずこれを用いる。身の取り方はいろいろあるが、料理人の仕方は、あり合わせの庖丁や、わさびおろしの取っ手の先で起こしている。しかし、一番安全にやる方法は、御飯をつける杓子の小さいのを貝の底に入れて起こすことで、これだと貝に傷がつかない。腸を潰さぬように出す必要があるから、この方法でやると腸は存外潰れない。あわびの腸の中にはドロドロしたものがあって、それを薄い膜が包んでいる。これを破ると中の青白いドロドロのものが出るから、破らないように注意しなければならない。腸を食べる方法は、水貝の時、生で器の中に入れると水が濁るから水貝と離して食べるほうがよい。生で食うにしても、そうしたほうがよろしい。また、やわらかいのをブツブツ切り、熱湯にサッと入れ、上皮の部分を熱湯に通して中は生のような、つまり、半熟につくり、それにレモン酢をつけて食べる。この方法もよろしい。しかし、ものの味から言うと、生で食べられるものは出来るだけ生、または生に近い方法で食べたほうが美味い。煮たり焼いたり、手を加えるほど味が崩れることを知っておくことが肝心だ。日本人が刺身を賞味するのは、総じて魚は生の肉が一番美味いことを証明していると言えよう。そのほか、甘辛く味付けして煮て食べるのもよい。これはただ煮ればよいのであるから、つくり方は簡単である。いずれも好き好きにやったほうがよろしい。　　　　　　　　";
var letters2 = "雨ニモマケズ風ニモマケズ雪ニモ夏ノ暑サニモマケヌ丈夫ナカラダヲモチ慾ハナク決シテ瞋ラズイツモシヅカニワラッテヰル一日ニ玄米四合ト味噌ト少シノ野菜ヲタベアラユルコトヲジブンヲカンジョウニ入レズニヨクミキキシワカリソシテワスレズ野原ノ松ノ林ノ※(「「蔭」の「陰のつくり」に代えて「人がしら／髟のへん」、第4水準2-86-78)ノ小サナ萓ブキノ小屋ニヰテ東ニ病気ノコドモアレバ行ッテ看病シテヤリ西ニツカレタ母アレバ行ッテソノ稲ノ朿ヲ［＃「朿ヲ」はママ］負ヒ南ニ死ニサウナ人アレバ行ッテコハガラナクテモイヽトイヒ北ニケンクヮヤソショウガアレバツマラナイカラヤメロトイヒヒドリノトキハナミダヲナガシサムサノナツハオロオロアルキミンナニデクノボートヨバレホメラレモセズクニモサレズサウイフモノニワタシハナリタイ南無無辺行菩薩南無上行菩薩南無多宝如来南無妙法蓮華経南無釈迦牟尼仏南無浄行菩薩南無安立行菩薩　　　　　　　　";
var letters4 = "ある晩、恭一はぞうりをはいて、すたすた鉄道線路の横の平らなところをあるいて居おりました。たしかにこれは罰金ばっきんです。おまけにもし汽車がきて、窓から長い棒などが出ていたら、一ぺんになぐり殺されてしまったでしょう。ところがその晩は、線路見まわりの工夫もこず、窓から棒の出た汽車にもあいませんでした。そのかわり、どうもじつに変てこなものを見たのです。九日の月がそらにかかっていました。そしてうろこ雲が空いっぱいでした。うろこぐもはみんな、もう月のひかりがはらわたの底までもしみとおってよろよろするというふうでした。その雲のすきまからときどき冷たい星がぴっかりぴっかり顔をだしました。恭一はすたすたあるいて、もう向うに停車場ていしゃばのあかりがきれいに見えるとこまできました。ぽつんとしたまっ赤なあかりや、硫黄いおうのほのおのようにぼうとした紫むらさきいろのあかりやらで、眼めをほそくしてみると、まるで大きなお城があるようにおもわれるのでした。とつぜん、右手のシグナルばしらが、がたんとからだをゆすぶって、上の白い横木を斜ななめに下の方へぶらさげました。これはべつだん不思議でもなんでもありません。つまりシグナルがさがったというだけのことです。一晩に十四じゅうし回もあることなのです。ところがそのつぎが大へんです。さっきから線路の左がわで、ぐゎあん、ぐゎあんとうなっていたでんしんばしらの列が大威張おおいばりで一ぺんに北のほうへ歩きだしました。みんな六むつの瀬戸せともののエボレットを飾かざり、てっぺんにはりがねの槍やりをつけた亜鉛とたんのしゃっぽをかぶって、片脚かたあしでひょいひょいやって行くのです。そしていかにも恭一をばかにしたように、じろじろ横めでみて通りすぎます。うなりもだんだん高くなって、いまはいかにも昔むかしふうの立派な軍歌に変ってしまいました。「ドッテテドッテテ、ドッテテド、でんしんばしらのぐんたいははやさせかいにたぐいなしドッテテドッテテ、ドッテテドでんしんばしらのぐんたいはきりつせかいにならびなし。」一本のでんしんばしらが、ことに肩かたをそびやかして、まるでうで木もがりがり鳴るくらいにして通りました。みると向うの方を、六本うで木の二十二の瀬戸もののエボレットをつけたでんしんばしらの列が、やはりいっしょに軍歌をうたって進んで行きます。「ドッテテドッテテ、ドッテテド二本うで木の工兵隊六本うで木の竜騎兵りゅうきへいドッテテドッテテ、ドッテテドいちれつ一万五千人はりがねかたくむすびたり」どういうわけか、二本のはしらがうで木を組んで、びっこを引いていっしょにやってきました。そしていかにもつかれたようにふらふら頭をふって、それから口をまげてふうと息を吐つき、よろよろ倒たおれそうになりました。するとすぐうしろから来た元気のいいはしらがどなりました。「おい、はやくあるけ。はりがねがたるむじゃないか。」ふたりはいかにも辛つらそうに、いっしょにこたえました。「もうつかれてあるけない。あしさきが腐くさり出したんだ。長靴ながぐつのタールもなにももうめちゃくちゃになってるんだ。」うしろのはしらはもどかしそうに叫さけびました。「はやくあるけ、あるけ。きさまらのうち、どっちかが参っても一万五千人みんな責任があるんだぞ。あるけったら。」二人はしかたなくよろよろあるきだし、つぎからつぎとはしらがどんどんやって来ます。「ドッテテドッテテ、ドッテテドやりをかざれるとたん帽ぼうすねははしらのごとくなり。ドッテテドッテテ、ドッテテド肩にかけたるエボレット重きつとめをしめすなり。」二人の影かげももうずうっと遠くの緑青ろくしょういろの林の方へ行ってしまい、月がうろこ雲からぱっと出て、あたりはにわかに明るくなりました。でんしんばしらはもうみんな、非常なご機嫌きげんです。恭一の前に来ると、わざと肩をそびやかしたり、横めでわらったりして過ぎるのでした。ところが愕おどろいたことは、六本うで木のまた向うに、三本うで木のまっ赤なエボレットをつけた兵隊があるいていることです。その軍歌はどうも、ふしも歌もこっちの方とちがうようでしたが、こっちの声があまり高いために、何をうたっているのか聞きとることができませんでした。こっちはあいかわらずどんどんやって行きます。「ドッテテドッテテ、ドッテテド、寒さはだえをつんざくもなどて腕木うでぎをおろすべきドッテテドッテテ、ドッテテド暑さ硫黄をとかすともいかでおとさんエボレット。」どんどんどんどんやって行き、恭一は見ているのさえ少しつかれてぼんやりなりました。でんしんばしらは、まるで川の水のように、次から次とやって来ます。みんな恭一のことを見て行くのですけれども、恭一はもう頭が痛くなってだまって下を見ていました。俄にわかに遠くから軍歌の声にまじって、「お一二、お一二、」というしわがれた声がきこえてきました。恭一はびっくりしてまた顔をあげてみますと、列のよこをせいの低い顔の黄いろなじいさんがまるでぼろぼろの鼠ねずみいろの外套がいとうを着て、でんしんばしらの列を見まわしながら「お一二、お一二、」と号令をかけてやってくるのでした。じいさんに見られた柱は、まるで木のように堅かたくなって、足をしゃちほこばらせて、わきめもふらず進んで行き、その変なじいさんは、もう恭一のすぐ前までやってきました。そしてよこめでしばらく恭一を見てから、でんしんばしらの方へ向いて、「なみ足い。おいっ。」と号令をかけました。そこででんしんばしらは少し歩調を崩くずして、やっぱり軍歌を歌って行きました。「ドッテテドッテテ、ドッテテド、右とひだりのサアベルはたぐいもあらぬ細身なり。」じいさんは恭一の前にとまって、からだをすこしかがめました。「今晩は、おまえはさっきから行軍を見ていたのかい。」 「ええ、見てました。」 「そうか、じゃ仕方ない。ともだちになろう、さあ、握手あくしゅしよう。」 じいさんはぼろぼろの外套の袖そでをはらって、大きな黄いろな手をだしました。恭一もしかたなく手を出しました。じいさんが「やっ、」と云いってその手をつかみました。するとじいさんの眼だまから、虎とらのように青い火花がぱちぱちっとでたとおもうと、恭一はからだがびりりっとしてあぶなくうしろへ倒れそうになりました。「ははあ、だいぶひびいたね、これでごく弱いほうだよ。わしとも少し強く握手すればまあ黒焦くろこげだね。」兵隊はやはりずんずん歩いて行きます。「ドッテテドッテテ、ドッテテド、タールを塗ぬれるなが靴の歩はばは三百六十尺。」恭一はすっかりこわくなって、歯ががちがち鳴りました。じいさんはしばらく月や雲の工合ぐあいをながめていましたが、あまり恭一が青くなってがたがたふるえているのを見て、気の毒になったらしく、少ししずかに斯こう云いました。「おれは電気総長だよ。」恭一も少し安心して「電気総長というのは、やはり電気の一種ですか。」とききました。するとじいさんはまたむっとしてしまいました。「わからん子供だな。ただの電気ではないさ。つまり、電気のすべての長、長というのはかしらとよむ。とりもなおさず電気の大将ということだ。」 「大将ならずいぶんおもしろいでしょう。」恭一がぼんやりたずねますと、じいさんは顔をまるでめちゃくちゃにしてよろこびました。「はっはっは、面白おもしろいさ。それ、その工兵も、その竜騎兵も、向うのてき弾兵だんへいも、みんなおれの兵隊だからな。」じいさんはぷっとすまして、片っ方の頬ほおをふくらせてそらを仰あおぎました。それからちょうど前を通って行く一本のでんしんばしらに、「こらこら、なぜわき見をするか。」とどなりました。するとそのはしらはまるで飛びあがるぐらいびっくりして、足がぐにゃんとまがりあわててまっすぐを向いてあるいて行きました。次から次とどしどしはしらはやって来ます。「有名なはなしをおまえは知ってるだろう。そら、むすこが、エングランド、ロンドンにいて、おやじがスコットランド、カルクシャイヤにいた。むすこがおやじに電報をかけた、おれはちゃんと手帳へ書いておいたがね、」じいさんは手帳を出して、それから大きなめがねを出してもっともらしく掛かけてから、また云いました。「おまえは英語はわかるかい、ね、センド、マイブーツ、インスタンテウリイすぐ長靴送れとこうだろう、するとカルクシャイヤのおやじめ、あわてくさっておれのでんしんのはりがねに長靴をぶらさげたよ。はっはっは、いや迷惑めいわくしたよ。それから英国ばかりじゃない、十二月ころ兵営へ行ってみると、おい、あかりをけしてこいと上等兵殿どのに云われて新兵が電燈をふっふっと吹ふいて消そうとしているのが毎年五人や六人はある。おれの兵隊にはそんなものは一人もないからな。おまえの町だってそうだ、はじめて電燈がついたころはみんながよく、電気会社では月に百石こくぐらい油をつかうだろうかなんて云ったもんだ。はっはっは、どうだ、もっともそれはおれのように勢力不滅ふめつの法則や熱力学第二則がわかるとあんまりおかしくもないがね、どうだ、ぼくの軍隊は規律がいいだろう。軍歌にもちゃんとそう云ってあるんだ。」でんしんばしらは、みんなまっすぐを向いて、すまし込こんで通り過ぎながら一きわ声をはりあげて、「ドッテテドッテテ、ドッテテドでんしんばしらのぐんたいのその名せかいにとどろけり。」と叫びました。そのとき、線路の遠くに、小さな赤い二つの火が見えました。するとじいさんはまるであわててしまいました。「あ、いかん、汽車がきた。誰たれかに見附みつかったら大へんだ。もう進軍をやめなくちゃいかん。」じいさんは片手を高くあげて、でんしんばしらの列の方を向いて叫びました。「全軍、かたまれい、おいっ。」でんしんばしらはみんな、ぴったりとまって、すっかりふだんのとおりになりました。軍歌はただのぐゎあんぐゎあんといううなりに変ってしまいました。汽車がごうとやってきました。汽缶車きかんしゃの石炭はまっ赤に燃えて、そのまえで火夫は足をふんばって、まっ黒に立っていました。ところが客車の窓がみんなまっくらでした。するとじいさんがいきなり、「おや、電燈が消えてるな。こいつはしまった。けしからん。」と云いながらまるで兎うさぎのようにせ中をまんまるにして走っている列車の下へもぐり込みました。「あぶない。」と恭一がとめようとしたとき、客車の窓がぱっと明るくなって、一人の小さな子が手をあげて「あかるくなった、わあい。」と叫んで行きました。でんしんばしらはしずかにうなり、シグナルはがたりとあがって、月はまたうろこ雲のなかにはいりました。そして汽車は、もう停車場ていしゃばへ着いたようでした。　　　　　　　　　";
var letters5 = "青森には、四年いました。青森中学に通っていたのです。親戚の豊田様のお家に、ずっと世話になっていました。寺町の呉服屋の、豊田様であります。豊田の、なくなった「お父どさ」は、私にずいぶん力こぶを入れて、何かとはげまして下さいました。私も、「おどさ」に、ずいぶん甘えていました。「おどさ」は、いい人でした。私が馬鹿な事ばかりやらかして、ちっとも立派な仕事をせぬうちになくなって、残念でなりません。もう五年、十年生きていてもらって、私が多少でもいい仕事をして、お父どさに喜んでもらいたかった、とそればかり思います。いま考えると「おどさ」の有難いところばかり思い出され、残念でなりません。私が中学校で少しでも佳よい成績をとると、おどさは、世界中の誰よりも喜んで下さいました。私が中学の二年生の頃、寺町の小さい花屋に洋画が五、六枚かざられていて、私は子供心にも、その画に少し感心しました。そのうちの一枚を、二円で買いました。この画はいまにきっと高くなります、と生意気な事を言って、豊田の「おどさ」にあげました。おどさは笑っていました。あの画は、今も豊田様のお家に、あると思います。いまでは百円でも安すぎるでしょう。棟方志功氏の、初期の傑作でした。棟方志功氏の姿は、東京で時折、見かけますが、あんまり颯爽さっそうと歩いているので、私はいつでも知らぬ振りをしています。けれども、あの頃の志功氏の画は、なかなか佳かったと思っています。もう、二十年ちかく昔の話になりました。豊田様のお家の、あの画が、もっと、うんと、高くなってくれたらいいと思って居ります。　　　　　　　　";
var letters6 = "桜の樹の下には屍体が埋まっている！これは信じていいことなんだよ。何故なぜって、桜の花があんなにも見事に咲くなんて信じられないことじゃないか。俺はあの美しさが信じられないので、この二三日不安だった。しかしいま、やっとわかるときが来た。桜の樹の下には屍体が埋まっている。これは信じていいことだ。どうして俺が毎晩家へ帰って来る道で、俺の部屋の数ある道具のうちの、選りに選ってちっぽけな薄っぺらいもの、安全剃刀の刃なんぞが、千里眼のように思い浮かんで来るのか――おまえはそれがわからないと言ったが――そして俺にもやはりそれがわからないのだが――それもこれもやっぱり同じようなことにちがいない。いったいどんな樹の花でも、いわゆる真っ盛りという状態に達すると、あたりの空気のなかへ一種神秘な雰囲気を撒き散らすものだ。それは、よく廻った独楽こまが完全な静止に澄むように、また、音楽の上手な演奏がきまってなにかの幻覚を伴うように、灼熱しゃくねつした生殖の幻覚させる後光のようなものだ。それは人の心を撲うたずにはおかない、不思議な、生き生きとした、美しさだ。しかし、昨日、一昨日、俺の心をひどく陰気にしたものもそれなのだ。俺にはその美しさがなにか信じられないもののような気がした。俺は反対に不安になり、憂鬱ゆううつになり、空虚な気持になった。しかし、俺はいまやっとわかった。おまえ、この爛漫らんまんと咲き乱れている桜の樹の下へ、一つ一つ屍体が埋まっていると想像してみるがいい。何が俺をそんなに不安にしていたかがおまえには納得がいくだろう。馬のような屍体、犬猫のような屍体、そして人間のような屍体、屍体はみな腐爛ふらんして蛆うじが湧き、堪たまらなく臭い。それでいて水晶のような液をたらたらとたらしている。桜の根は貪婪どんらんな蛸たこのように、それを抱きかかえ、いそぎんちゃくの食糸のような毛根を聚あつめて、その液体を吸っている。何があんな花弁を作り、何があんな蕊しべを作っているのか、俺は毛根の吸いあげる水晶のような液が、静かな行列を作って、維管束のなかを夢のようにあがってゆくのが見えるようだ。――おまえは何をそう苦しそうな顔をしているのだ。美しい透視術じゃないか。俺はいまようやく瞳ひとみを据えて桜の花が見られるようになったのだ。昨日、一昨日、俺を不安がらせた神秘から自由になったのだ。二三日前、俺は、ここの溪たにへ下りて、石の上を伝い歩きしていた。水のしぶきのなかからは、あちらからもこちらからも、薄羽かげろうがアフロディットのように生まれて来て、溪の空をめがけて舞い上がってゆくのが見えた。おまえも知っているとおり、彼らはそこで美しい結婚をするのだ。しばらく歩いていると、俺は変なものに出喰でくわした。それは溪の水が乾いた磧かわらへ、小さい水溜を残している、その水のなかだった。思いがけない石油を流したような光彩が、一面に浮いているのだ。おまえはそれを何だったと思う。それは何万匹とも数の知れない、薄羽かげろうの屍体だったのだ。隙間なく水の面を被っている、彼らのかさなりあった翅はねが、光にちぢれて油のような光彩を流しているのだ。そこが、産卵を終わった彼らの墓場だったのだ。俺はそれを見たとき、胸が衝つかれるような気がした。墓場を発あばいて屍体を嗜このむ変質者のような残忍なよろこびを俺は味わった。この溪間ではなにも俺をよろこばすものはない。鶯うぐいすや四十雀しじゅうからも、白い日光をさ青に煙らせている木の若芽も、ただそれだけでは、もうろうとした心象に過ぎない。俺には惨劇が必要なんだ。その平衡があって、はじめて俺の心象は明確になって来る。俺の心は悪鬼のように憂鬱に渇いている。俺の心に憂鬱が完成するときにばかり、俺の心は和なごんでくる。――おまえは腋わきの下を拭ふいているね。冷汗が出るのか。それは俺も同じことだ。何もそれを不愉快がることはない。べたべたとまるで精液のようだと思ってごらん。それで俺達の憂鬱は完成するのだ。ああ、桜の樹の下には屍体が埋まっている！いったいどこから浮かんで来た空想かさっぱり見当のつかない屍体が、いまはまるで桜の樹と一つになって、どんなに頭を振っても離れてゆこうとはしない。今こそ俺は、あの桜の樹の下で酒宴をひらいている村人たちと同じ権利で、花見の酒が呑のめそうな気がする。　　　　　　　　";
var letters7 = "私はもう歌なぞ歌はない誰が歌なぞ歌ふものかみんな歌なぞ聴いてはゐない聴いてるやうなふりだけはするみんなたゞ冷たい心を持つてゐて歌なぞどうだつてかまはないのだそれなのに聴いてるやうなふりはするそして盛んに拍手を送る拍手を送るからもう一つ歌はうとするともう沢山といつた顔私はもう歌なぞ歌はないこんな御都合な世の中に歌なぞ歌はない　　　　　（一九三五・九・一九）　　　　　　　　";
var letters8 = "僕は或初夏の午後、谷崎氏と神田をひやかしに出かけた。谷崎氏はその日も黒背広に赤い襟飾りを結んでゐた。僕はこの壮大なる襟飾りに、象徴せられたるロマンティシズムを感じた。尤もこれは僕ばかりではない。往来の人も男女を問はず、僕と同じ印象を受けたのであらう。すれ違ふ度に谷崎氏の顔をじろじろ見ないものは一人もなかつた。しかし谷崎氏は何と云つてもさう云ふ事実を認めなかつた。「ありや君を見るんだよ。そんな道行きなんぞ着てゐるから。」僕は成程夏外套の代りに親父の道行きを借用してゐた。が、道行きは茶の湯の師匠も菩提寺の和尚も着るものである。衆俗の目を駭かすことは到底一輪の紅薔薇に似た、非凡なる襟飾りに及ぶ筈はない。けれども谷崎氏は僕のやうにロヂックを尊敬しない詩人だから、僕も亦強ひてこの真理を呑みこませようとも思はなかつた。その内に僕等は裏神保町の或カッフエへ腰を下した。何でも喉の渇いたため、炭酸水か何か飲みにはひつたのである。僕は飲みものを註文した後も、つらつら谷崎氏の喉もとに燃えたロマンティシズムの烽火を眺めてゐた。すると白粉の剥げた女給が一人、両手にコツプを持ちながら、僕等のテエブルへ近づいて来た。コツプは真理のやうに澄んだ水に細かい泡を躍らせてゐた。女給はそのコツプを一つづつ、僕等の前へ立て並べた。それから、――僕はまだ鮮かにあの女給の言葉を覚えてゐる！　女給は立ち去り難いやうにテエブルへ片手を残したなり、しけじけと谷崎氏の胸を覗きこんだ。「まあ、好い色のネクタイをしていらつしやるわねえ。」十分の後、僕はテエブルを離れる時に五十銭のティップを渡さうとした。谷崎氏はあらゆる東京人のやうに無用のティップをやることに軽蔑を感ずる一人である。この時も勿論五十銭のティップは谷崎氏の冷笑を免れなかつた。「何にも君、世話にはならないぢやないか？」僕はこの先輩の冷笑にも羞ぢず、皺だらけの札を女給へ渡した。女給は何も僕等の為に炭酸水を運んだばかりではない。又実に僕の為には赤い襟飾りに関する真理を天下に挙揚してくれたのである。僕はまだこの時の五十銭位誠意のあるティップをやつたことはない。　　　　　　　　";
var letters9 = "法律と風習とによって、ある永劫えいごうの社会的処罰が存在し、かくして人為的に地獄を文明のさなかにこしらえ、聖なる運命を世間的因果によって紛糾せしむる間は、すなわち、下層階級による男の失墜、飢餓による女の堕落、暗黒による子供の萎縮いしゅく、それら時代の三つの問題が解決せられない間は、すなわち、ある方面において、社会的窒息が可能である間は、すなわち、言葉を換えて言えば、そしてなおいっそう広い見地よりすれば、地上に無知と悲惨とがある間は、本書のごとき性質の書物も、おそらく無益ではないであろう。　　　　　　　　　　　一八六二年一月一日オートヴィル・ハウスにおいて";
var letters = letters1;

var titles = ["小説の面白さ", "〔雨ニモマケズ〕", "鮑の水貝", "月夜のでんしんばしら", "青森", "桜の樹の下には", "詩人は辛い", "谷崎潤一郎氏", "レ・ミゼラブル 03 序"];
var authors = ["太宰治", "宮沢賢治", "北大路魯山人", "宮沢賢治", "太宰治", "梶井基次郎", "中原中也", "芥川龍之介", "ヴィクトル・ユゴー"];


var currentTitle = titles[0];
var currentAuthor = authors[0];

var fontSizeMin = 15;
var angleDistortion = 0.0;

var counter = 0;
var fadingTexts = []; // テキストとその透明度を保持
var titleFadingTexts = []; // タイトル用の文字情報を保持
var authorFadingTexts = []; // 著者名用の文字情報を保持

var siteTitle = "線小説"; // サイト名
var siteTitleX, siteTitleY;
var siteFadingTexts = []; // サイト名の文字情報を保持
var letterSpacing = 48; // 文字間隔を得ってい
var startTime;
var displayTitle = false; // タイトル表示のフラグ

var endTime = 0; // 終了時間を記録する変数
var displayEndText = false; // 終了テキスト表示フラグ
var initialDisplayDone = false; // 初期表示が完了したかどうかのフラグ

function setup() {
  createCanvas(windowWidth, windowHeight);
  background(255);
  cursor(CROSS);

  x = mouseX;
  y = mouseY;

  textFont(font);
  textAlign(CENTER); 

  siteTitleX = width / 2 - (siteTitle.length * letterSpacing) / 2;
  siteTitleY = height / 2;

  // サイト名の文字情報を配列に格納
  for (let i = 0; i < siteTitle.length; i++) {
    let char = siteTitle.charAt(i);
    siteFadingTexts.push({
      letter: char,
      x: siteTitleX + i * letterSpacing,
      y: siteTitleY,
      alpha: 255,
      delay: i * 200 // 各文字が順番にフェードアウトを開始する遅延時間
    });
  }

  titleX = width / 2 - (currentTitle.length * letterSpacing) / 2; // タイトルのx座標を画面の中央に
  titleY = height / 2 - 40; // タイトルのy座標を画面の中央より少し上に
  authorX = width / 2 - (currentAuthor.length * letterSpacing) / 2; // 著者名のx座標を画面の中央に
  authorY = height / 2 + 20; // 著者名のy座標を画面の中央に

  // タイトルの文字情報を配列に格納
  for (let i = 0; i < currentTitle.length; i++) {
    let char = currentTitle.charAt(i);
    titleFadingTexts.push({
      letter: char,
      x: titleX + i * letterSpacing,
      y: titleY,
      alpha: 255,
      delay: i * 200 // 各文字が順番にフェードアウトを開始する遅延時間
    });
  }

  // 著者名の文字情報を配列に格納
  for (let i = 0; i < currentAuthor.length; i++) {
    let char = currentAuthor.charAt(i);
    authorFadingTexts.push({
      letter: char,
      x: authorX + i * letterSpacing,
      y: authorY,
      alpha: 255,
      delay: i * 200 // 各文字が順番にフェードアウトを開始する遅延時間
    });
  }

  fill(0);

  startTime = millis(); // 現在の時間を記憶
}

function draw() {
  background(255); // 透明度のパラメータを取り除く

  var currentTime = millis();
  siteFadingTexts.forEach(ft => {
    if (currentTime - startTime > ft.delay) {
      fill(0, 0, 0, ft.alpha);
      textSize(48); // サイト名のフォントサイズ
      text(ft.letter, ft.x, ft.y);
      ft.alpha -= 2; // 透明度を2ずつ減らす
    }
  });

  // 透明度が0になったテキストを配列から削除
  siteFadingTexts = siteFadingTexts.filter(ft => ft.alpha > 0);

  // サイト名のフェードアウトが完了したらタイトルと著者を表示
  if (siteFadingTexts.length === 0 && !displayTitle) {
    displayTitle = true;
    startTime = millis(); // タイトル表示開始時間を記録
  }

  // タイトルの描画と透明度の更新
  if (displayTitle && !initialDisplayDone) {
    titleFadingTexts.forEach(ft => {
      if (currentTime - startTime > ft.delay) {
        fill(0, 0, 0, ft.alpha);
        textSize(32); // タイトルのフォントサイズ
        text(ft.letter, ft.x, ft.y);
        ft.alpha -= 2; // 透明度を2ずつ減らす
      }
    });

    // 透明度が0になったテキストを配列から削除
    titleFadingTexts = titleFadingTexts.filter(ft => ft.alpha > 0);

    // 著者名の描画と透明度の更新
    authorFadingTexts.forEach(ft => {
      if (currentTime - startTime > ft.delay) {
        fill(0, 0, 0, ft.alpha);
        textSize(24); // 著者名のフォントサイズ
        text(ft.letter, ft.x, ft.y);
        ft.alpha -= 2; // 透明度を2ずつ減らす
      }
    });

    // 透明度が0になったテキストを配列から削除
    authorFadingTexts = authorFadingTexts.filter(ft => ft.alpha > 0);

    if (titleFadingTexts.length === 0 && authorFadingTexts.length === 0) {
      initialDisplayDone = true; // 初期表示が完了したと設定
    }
  }

  // 残りの文字数インジケーターの描画
  var remaining = letters.length - counter;
  var progress = remaining / letters.length; // 残りの文字数の割合を計算
  fill(0);
  noStroke();
  rect(0, 0, width * progress, 10); // 残りの文字数に応じてインジケーターの幅を調整

  // 保存されたテキストの描画と透明度の更新
  fadingTexts.forEach(ft => {
    fill(0, 0, 0, ft.alpha);
    textSize(ft.size);
    text(ft.letter, ft.x, ft.y);
    ft.alpha -= 2; // 透明度を2ずつ減らす
  });

  // 透明度が0になったテキストを配列から削除
  fadingTexts = fadingTexts.filter(ft => ft.alpha > 0);

  // 終了テキスト表示フラグが有効で、3秒が経過していない場合は文字描画を無効化
  if (displayEndText && (currentTime - endTime < 3000)) {
    fill(0);
    textSize(32);
    text("終わり．", width / 2, height / 2);
    return;
  } else if (displayEndText && (currentTime - endTime >= 3000)) {
    displayEndText = false; // 3秒経過後に終了テキスト表示フラグを無効化
  }

  if (mouseIsPressed && mouseButton == LEFT && !displayEndText && initialDisplayDone) {
    var d = dist(x, y, mouseX, mouseY);
    var adjustedSize = sqrt(d) * 2;
    var fontSize = fontSizeMin + adjustedSize;
    var newLetter = letters.charAt(counter);
    stepSize = textWidth(newLetter);

    if (d > stepSize) {
      var angle = atan2(mouseY - y, mouseX - x);

      push();
      translate(x, y);
      fill(0);
      text(newLetter, 0, 0);
      pop();

      // 新しいテキスト情報を保存
      fadingTexts.push({
        letter: newLetter,
        x: x,
        y: y,
        size: fontSize,
        alpha: 255 // 初期透明度は255
      });

      counter++;
      if (counter >= letters.length) {
        counter = 0;
        // 残り文字数がゼロになった際に「終わり．」を表示
        fill(0);
        textSize(32);
        text("終わり．", width / 2, height / 2);
        displayEndText = true; // 終了テキスト表示フラグを有効化
        endTime = millis(); // 終了時間を記録
      }

      x = x + cos(angle) * stepSize;
      y = y + sin(angle) * stepSize;
    }
  }
}

function mousePressed() {
  if (!displayEndText && initialDisplayDone) {
    x = mouseX;
    y = mouseY;
  }
}

function keyPressed() {
  if (!displayEndText) {
    if (key === '1') {
      letters = letters1;
      currentTitle = titles[0];
      currentAuthor = authors[0];
    } else if (key === '2') {
      letters = letters2;
      currentTitle = titles[1];
      currentAuthor = authors[1];
    } else if (key === '3') {
      letters = letters3;
      currentTitle = titles[2];
      currentAuthor = authors[2];
    } else if (key === '4') {
      letters = letters4;
      currentTitle = titles[3];
      currentAuthor = authors[3];
    } else if (key === '5') {
      letters = letters5;
      currentTitle = titles[4];
      currentAuthor = authors[4];
    } else if (key === '6') {
      letters = letters6;
      currentTitle = titles[5];
      currentAuthor = authors[5];
    } else if (key === '7') {
      letters = letters7;
      currentTitle = titles[6];
      currentAuthor = authors[6];
    } else if (key === '8') {
      letters = letters8;
      currentTitle = titles[7];
      currentAuthor = authors[7];
    } else if (key === '9') {
      letters = letters9;
      currentTitle = titles[8];
      currentAuthor = authors[8];
    }
    counter = 0;
    titleFadingTexts = [];
    authorFadingTexts = [];
    titleX = width / 2 - (currentTitle.length * letterSpacing) / 2;
    titleY = height / 2 - 40;
    authorX = width / 2 - (currentAuthor.length * letterSpacing) / 2;
    authorY = height / 2 + 20;

    for (let i = 0; i < currentTitle.length; i++) {
      let char = currentTitle.charAt(i);
      titleFadingTexts.push({
        letter: char,
        x: titleX + i * letterSpacing,
        y: titleY,
        alpha: 255,
        delay: i * 200
      });
    }

    for (let i = 0; i < currentAuthor.length; i++) {
      let char = currentAuthor.charAt(i);
      authorFadingTexts.push({
        letter: char,
        x: authorX + i * letterSpacing,
        y: authorY,
        alpha: 255,
        delay: i * 200
      });
    }
    initialDisplayDone = false; // 新しいタイトルと著者を設定する際に初期表示フラグをリセット
  }
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);

  // キャンバスがリサイズされた時に中央揃えの座標を再計算
  titleX = width / 2 - (currentTitle.length * letterSpacing) / 2;
  titleY = height / 2 - 40;
  authorX = width / 2 - (currentAuthor.length * letterSpacing) / 2;
  authorY = height / 2 + 20;
}
