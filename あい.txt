var x = 0;
var y = 0;
var stepSize = 5.0;

var font = 'Zen Old Mincho';

var letters = "透明人間";
var fontSizeMin = 15;
var angleDistortion = 0.0;

var counter = 0;
var fadingTexts = []; // テキストとその透明度を保持する配列

function setup() {
  createCanvas(displayWidth, displayHeight);
  background(255);
  cursor(CROSS);

  x = mouseX;
  y = mouseY;

  textFont(font);
  textAlign(LEFT);
  fill(0);
}

function draw() {
  background(255, 255, 255, 25); // 背景を軽く透明にすることで古い文字が徐々に薄れる

  // 保存されたテキストの描画と透明度の更新
  fadingTexts.forEach(ft => {
    fill(0, 0, 0, ft.alpha);
    textSize(ft.size);
    text(ft.letter, ft.x, ft.y);
    ft.alpha -= 2; // 透明度を2ずつ減らす
  });

  // 透明度が0になったテキストを配列から削除
  fadingTexts = fadingTexts.filter(ft => ft.alpha > 0);

  if (mouseIsPressed && mouseButton == LEFT) {
    var d = dist(x, y, mouseX, mouseY);
    var adjustedSize = sqrt(d) * 2;
    var fontSize = fontSizeMin + adjustedSize;
    var newLetter = letters.charAt(counter);
    stepSize = textWidth(newLetter);

    if (d > stepSize) {
      var angle = atan2(mouseY - y, mouseX - x);

      push();
      translate(x, y);
      fill(0);
      text(newLetter, 0, 0);
      pop();

      // 新しいテキスト情報を保存
      fadingTexts.push({
        letter: newLetter,
        x: x,
        y: y,
        size: fontSize,
        alpha: 255 // 初期透明度は255
      });

      counter++;
      if (counter >= letters.length) counter = 0;

      x = x + cos(angle) * stepSize;
      y = y + sin(angle) * stepSize;
    }
  }
}

function mousePressed() {
  x = mouseX;
  y = mouseY;
}
